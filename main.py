import logging
from aiogram import Bot, Dispatcher, types
from aiogram.utils import executor
from config import TOKEN  # —Ç–æ–∫–µ–Ω –º—ã –ø–æ–ª–æ–∂–∏–º –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª config.py

logging.basicConfig(level=logging.INFO)

bot = Bot(token=TOKEN)
dp = Dispatcher(bot)

# –ü—Ä–æ—Å—Ç–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ (–ø–æ–∫–∞ –≤ –ø–∞–º—è—Ç–∏)
participants = {}


@dp.message_handler(commands=['start'])
async def start(message: types.Message):
    """
    –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã /start.
    –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø—Ä–æ—Å–∏–º –Ω–∞–ø–∏—Å–∞—Ç—å –ø–æ–∂–µ–ª–∞–Ω–∏—è –∫ –ø–æ–¥–∞—Ä–∫—É.
    """
    user_id = message.from_user.id

    # —Å–æ–∑–¥–∞—ë–º –∑–∞–ø–∏—Å—å –æ–± —É—á–∞—Å—Ç–Ω–∏–∫–µ, –µ—Å–ª–∏ –µ—ë –µ—â—ë –Ω–µ—Ç
    if user_id not in participants:
        participants[user_id] = {
            "name": message.from_user.full_name
        }

    text = (
        "–•–∞—Ä–µ –ö—Ä–∏—à–Ω–∞!‚ú®\n"
        "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –Ω–∞—à—É —Ç—ë–ø–ª—É—é –∏–≥—Ä—É –í–∞–π—à–Ω–∞–≤—Å–∫–æ–≥–æ –°–∞–Ω—Ç—ã üéÅ\n\n"
        "–ü—É—Å—Ç—å —ç—Ç–∞ –º–∞–ª–µ–Ω—å–∫–∞—è –∏–≥—Ä–∞ –ø—Ä–∏–Ω–µ—Å—ë—Ç —Ç–µ–±–µ —Ä–∞–¥–æ—Å—Ç—å –∏ –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ "
        "–î–∞—Ä–∏—Ç—å –ø–æ–¥–∞—Ä–∫–∏ –∏ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –ø–æ–¥–∞—Ä–∫–∏" üòâ.\n\n"
        "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞–ø–∏—à–∏ —Å–≤–æ–∏ –ø–æ–∂–µ–ª–∞–Ω–∏—è –∫ –ø–æ–¥–∞—Ä–∫—É –∏–ª–∏ –Ω–∞–ø–∏—à–∏, –µ—Å–ª–∏ —Ö–æ—á–µ—à—å —Å—é—Ä–ø—Ä–∏–∑ üòÅ\n"
        "(–¢—ã –º–æ–∂–µ—à—å –ø–µ—Ä–µ—á–∏—Å–ª–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤)"
    )

    await message.answer(text)


@dp.message_handler(lambda m: m.from_user.id in participants and "wishlist" not in participants[m.from_user.id])
async def wishlist(message: types.Message):
    """
    –ü–µ—Ä–≤—ã–π —Ç–µ–∫—Å—Ç –ø–æ—Å–ª–µ /start ‚Äî —Å—á–∏—Ç–∞–µ–º –µ–≥–æ —Å–ø–∏—Å–∫–æ–º –ø–æ–∂–µ–ª–∞–Ω–∏–π.
    –ó–∞—Ç–µ–º –ø—Ä–æ—Å–∏–º –∞–¥—Ä–µ—Å.
    """
    user_id = message.from_user.id
    participants[user_id]["wishlist"] = message.text

    text = (
        "–ü—Ä–∏–Ω—è—Ç–æ! üíõ\n"
        "–ú—ã –ø–µ—Ä–µ–¥–∞–¥–∏–º —ç—Ç—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é —Ç–≤–æ–µ–º—É –í–∞–π—à–Ω–∞–≤—Å–∫–æ–º—É –°–∞–Ω—Ç–µ.\n\n"
        "–¢–µ–ø–µ—Ä—å –Ω–∞–ø–∏—à–∏ –∞–¥—Ä–µ—Å, –∫—É–¥–∞ —Ç–≤–æ–π –í–∞–π—à–Ω–∞–≤—Å–∫–∏–π –°–∞–Ω—Ç–∞ "
        "—Å–º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–¥–∞—Ä–æ–∫. "
        "–≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É–Ω–∫—Ç –≤—ã–¥–∞—á–∏ Wildberries, Ozon –∏–ª–∏ –ø–æ—á—Ç–∞ –†–æ—Å—Å–∏–∏. "
        "–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–∫–∞–∂–∏, –∞–¥—Ä–µ—Å –∫–∞–∫–æ–≥–æ –∏–º–µ–Ω–Ω–æ –ø—É–Ω–∫—Ç–∞ —Ç—ã —É–∫–∞–∑–∞–ª (Wildberries, Ozon –∏–ª–∏ –ø–æ—á—Ç–∞ –†–æ—Å—Å–∏–∏), "
        "—á—Ç–æ–±—ã –í–∞–π—à–Ω–∞–≤—Å–∫–∏–π –°–∞–Ω—Ç–∞ –Ω–µ –∑–∞–ø—É—Ç–∞–ª—Å—è –∏ –∑–∞–∫–∞–∑–∞–ª –ø–æ–¥–∞—Ä–æ–∫ —Ç–∞–º, –≥–¥–µ –Ω—É–∂–Ω–æ üòâüéÅ\n"
        "(–û–Ω —É–≤–∏–¥–∏—Ç –µ–≥–æ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è, —Ç–∞–∫ —á—Ç–æ –≤—Å—ë –æ—Å—Ç–∞—ë—Ç—Å—è –∞–Ω–æ–Ω–∏–º–Ω–æ.)"
    )

    await message.answer(text)


@dp.message_handler(
    lambda m: (
        m.from_user.id in participants
        and "wishlist" in participants[m.from_user.id]
        and "address" not in participants[m.from_user.id]
    )
)
async def address(message: types.Message):
    """
    –í—Ç–æ—Ä–æ–π —Ç–µ–∫—Å—Ç –ø–æ—Å–ª–µ –ø–æ–∂–µ–ª–∞–Ω–∏–π ‚Äî –∞–¥—Ä–µ—Å.
    –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º —É—á–∞—Å—Ç–∏–µ.
    """
    user_id = message.from_user.id
    participants[user_id]["address"] = message.text

    text = (
        "–•–∞—Ä–∏–±–æ–ª! üéÑ\n"
        "–°–ø–∞—Å–∏–±–æ —Ç–µ–±–µ –∑–∞ –¥–æ–≤–µ—Ä–∏–µ –∏ —É—á–∞—Å—Ç–∏–µ –≤ —ç—Ç–æ–π –º–∞–ª–µ–Ω—å–∫–æ–π –∏–≥—Ä–µ üí´\n\n"
        "–¢—ã —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª–∞—Å—å –∫ –∫–ª—É–±—É –í–∞–π—à–Ω–∞–≤—Å–∫–∏—Ö –°–∞–Ω—Ç üéÖ‚ú®\n"
        "–°–∫–æ—Ä–æ —Ç—ã –ø–æ–ª—É—á–∏—à—å –∏–º—è —Ç–æ–≥–æ, –∫–æ–º—É —Å–º–æ–∂–µ—à—å –ø–æ–¥–∞—Ä–∏—Ç—å "
        "—á–∞—Å—Ç–∏—á–∫—É —Ç–µ–ø–ª–∞ –∏ –≤–Ω–∏–º–∞–Ω–∏—è üíõ"
    )

    await message.answer(text)


if __name__ == "__main__":
    executor.start_polling(dp, skip_updates=True)
